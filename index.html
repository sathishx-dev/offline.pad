<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>OfflinePad — Dontpad-like (offline)</title>
<style>
  :root{font-family:system-ui,Segoe UI,Roboto,"Noto Sans",sans-serif}
  body{margin:0;display:flex;flex-direction:column;height:100vh}
  header{background:#111;color:#fff;padding:12px 16px;display:flex;gap:8px;align-items:center}
  input[type="text"]{padding:8px;border-radius:6px;border:1px solid #ccc}
  button{padding:8px 10px;border-radius:6px;border:0;background:#0b74ff;color:#fff;cursor:pointer}
  button.ghost{background:#eee;color:#111}
  main{flex:1;display:flex;flex-direction:column;padding:12px}
  textarea{flex:1;width:100%;padding:12px;font-size:15px;border:1px solid #ddd;border-radius:8px;resize:none;line-height:1.4}
  .row{display:flex;gap:8px;align-items:center}
  footer{padding:8px 12px;background:#fafafa;border-top:1px solid #eee;font-size:13px}
  small.status{margin-left:auto;color:#666}
  .hint{color:#666;font-size:13px}
</style>
</head>
<body>
<header>
  <strong>OfflinePad</strong>
  <div style="display:flex;gap:8px;align-items:center;margin-left:12px">
    <label class="hint">Slug:</label>
    <input id="slug" type="text" placeholder="like sathish" value="default" />
    <button id="loadBtn" class="ghost">Load</button>
    <button id="newBtn" class="ghost">New</button>
    <button id="downloadBtn">Download</button>
    <button id="exportBtn" class="ghost">Export</button>
    <button id="importBtn" class="ghost">Import</button>
    <button id="clearBtn" class="ghost">Clear Storage</button>
  </div>
  <small class="status" id="status">Idle</small>
</header>

<main>
  <div class="row" style="margin-bottom:8px">
    <div style="flex:1">
      <div class="hint">Tip: change slug to keep multiple notes (saved in browser).</div>
    </div>
  </div>
  <textarea id="pad" placeholder="Start typing..."></textarea>
</main>

<footer>
  Open this file directly (double-click) or run a local server to share on LAN.
  <span style="float:right" class="hint">No accounts — data stored only in this browser.</span>
</footer>

<script>
(function(){
  const pad = document.getElementById('pad');
  const slugInput = document.getElementById('slug');
  const status = document.getElementById('status');
  const loadBtn = document.getElementById('loadBtn');
  const newBtn = document.getElementById('newBtn');
  const downloadBtn = document.getElementById('downloadBtn');
  const exportBtn = document.getElementById('exportBtn');
  const importBtn = document.getElementById('importBtn');
  const clearBtn = document.getElementById('clearBtn');

  let saveTimer = null;
  function keyFor(slug){ return 'offlinepad_' + slug; }

  function setStatus(t){
    status.textContent = t;
  }

  function saveNow(){
    const slug = (slugInput.value || 'default').trim();
    const data = { slug, content: pad.value, ts: new Date().toISOString() };
    try {
      localStorage.setItem(keyFor(slug), JSON.stringify(data));
      setStatus('Saved ' + new Date().toLocaleTimeString());
    } catch(e) {
      setStatus('Save failed (storage full?)');
    }
  }

  function loadSlug(){
    const slug = (slugInput.value || 'default').trim();
    const raw = localStorage.getItem(keyFor(slug));
    if(raw){
      try{
        const data = JSON.parse(raw);
        pad.value = data.content || '';
        setStatus('Loaded ['+slug+'] — ' + (data.ts ? new Date(data.ts).toLocaleString() : 'unknown'));
      } catch(e){
        pad.value = raw;
        setStatus('Loaded raw');
      }
    } else {
      pad.value = '';
      setStatus('Empty — new note for ['+slug+']');
    }
  }

  pad.addEventListener('input', ()=>{
    setStatus('Typing...');
    if(saveTimer) clearTimeout(saveTimer);
    saveTimer = setTimeout(saveNow, 500); // debounce
  });

  loadBtn.addEventListener('click', loadSlug);
  newBtn.addEventListener('click', ()=>{
    slugInput.value = prompt('Enter new slug/name for note','note-'+Date.now()) || 'default';
    loadSlug();
  });

  downloadBtn.addEventListener('click', ()=>{
    const slug = (slugInput.value||'default').trim();
    const blob = new Blob([pad.value], {type:'text/plain'});
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = slug + '.txt';
    document.body.appendChild(a);
    a.click();
    a.remove();
    setStatus('Downloaded');
  });

  exportBtn.addEventListener('click', ()=>{
    const slug = (slugInput.value||'default').trim();
    const raw = localStorage.getItem(keyFor(slug));
    if(!raw){ alert('No data to export for slug: ' + slug); return; }
    navigator.clipboard?.writeText(raw).then(()=> {
      alert('Exported JSON copied to clipboard. Use Import to restore on another browser.');
    }).catch(()=> {
      prompt('Copy this JSON (Ctrl+C):', raw);
    });
  });

  importBtn.addEventListener('click', ()=>{
    const payload = prompt('Paste exported JSON here:');
    if(!payload) return;
    try{
      const obj = JSON.parse(payload);
      const slug = obj.slug || (slugInput.value||'default').trim();
      localStorage.setItem(keyFor(slug), JSON.stringify(obj));
      slugInput.value = slug;
      loadSlug();
      alert('Imported to slug: ' + slug);
    }catch(e){
      alert('Invalid JSON');
    }
  });

  clearBtn.addEventListener('click', ()=>{
    if(confirm('Clear ALL OfflinePad data in this browser? This cannot be undone.')) {
      const keys = Object.keys(localStorage).filter(k => k.startsWith('offlinepad_'));
      keys.forEach(k => localStorage.removeItem(k));
      pad.value = '';
      setStatus('All OfflinePad data cleared');
    }
  });

  // init: try read slug from URL hash
  const initialSlug = (location.hash && location.hash.slice(1)) || 'default';
  slugInput.value = initialSlug;
  loadSlug();

  // auto-save on unload
  window.addEventListener('beforeunload', saveNow);
})();
</script>
</body>
</html>
